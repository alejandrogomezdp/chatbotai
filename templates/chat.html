<!doctype html>
<html>
    <head>
        <title>Chat</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }

            .container {
                display: flex;
                max-width: 1666px;
                margin: 0 auto;
                padding: 20px;
            }

            .sidebar {
                width: 15%;
                padding-right: 20px;
                border-right: 1px solid #ccc;
            }

            .sidebar-tabs {
                list-style-type: none;
                padding: 0;
                margin: 0;
            }

            .sidebar-tab {
                margin-bottom: 10px;
                position: float;
                align-items: left;
            }

            .sidebar-tab .sidebar-tab-link {
                display: flex;
                align-items: center;
                text-decoration: none;
                color: #000;
            }

            .sidebar-tab .sidebar-tab-link:hover {
                color: #007bff;
            }

            .sidebar-tab .sidebar-tab-link .sidebar-tab-icon {
                margin-right: 5px;
            }

            .sidebar-tab .sidebar-tab-link.active {
                font-weight: bold;
            }

            .chat-container {
                flex-grow: 1;
                border: 1px solid #ccc;
                background-color: #fff;
                margin-left: 20px;
                padding: 20px;
                min-width: 1200px;
                height: 30%;
                overflow-y: scroll;
            }

            .chat-message {
                margin-bottom: 20px;
            }

            .input-container {
                display: flex;
                justify-content: di;
                margin-top: 20px;
            }

            .input-container input {
                flex-grow: 1;
                margin-right: 20px;
                padding: 10px;
                border: 1px solid #ccc;
            }

            .input-container button {
                padding: 10px 20px;
                border: none;
                background-color: #007bff;
                color: #fff;
                cursor: pointer;
            }

            .input-container button:hover {
                background-color: #0056b3;
            }

            .alert-danger {
                margin-top: 20px;
                text-align: center;
            }

            textarea {
                margin: auto;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="sidebar">
                <ul class="sidebar-tabs">
                    <li class="sidebar-tab">
                        <a href="#" class="sidebar-tab-link active">
                            <span class="sidebar-tab-icon">+</span> Nuevo Chat
                        </a>
                    </li>
                    {% for conversation in conversations %}
                    <li class="sidebar-tab">
                        <a
                            href="{{ url_for('chat', conversation_id=conversation.id) }}"
                            class="sidebar-tab-link"
                        >
                            {{ conversation.user_input[:20] }}...
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="chat-container">
                {% for conversation in conversations %}
                <div class="chat-message">
                    <p><strong>User:</strong> {{ conversation.user_input }}</p>
                    <p>
                        <strong>Chatbot:</strong> {{
                        conversation.chatbot_response }}
                    </p>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="input-container">
            <textarea
                id="messageInput"
                rows="3"
                placeholder="Escribe un mensaje..."
                oninput="resizeInput(this)"
                onKeyDown="sendMessage(event)"
            ></textarea>
            <button id="sendButton">Enviar</button>
        </div>

        <script>
            function scrollToBottom() {
                const chatContainer = document.querySelector('.chat-container')
                chatContainer.scrollTop = chatContainer.scrollHeight
            }

            function addMessageToChat(role, content) {
                const chatContainer = document.querySelector('.chat-container')
                const messageDiv = document.createElement('div')
                messageDiv.className = 'chat-message'
                const roleTag = document.createElement('strong')
                roleTag.textContent =
                    role.charAt(0).toUpperCase() + role.slice(1)
                const messageContent = document.createElement('p')
                messageContent.innerHTML = `<strong>${roleTag.textContent}:</strong> ${content}`
                messageDiv.appendChild(messageContent)
                chatContainer.appendChild(messageDiv)
            }

            function postUserMessage(message) {
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                    }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        addMessageToChat('chatbot', data.response)
                        scrollToBottom()
                    })
                    .catch((error) => console.error(error))
            }

            document
                .querySelector('.sidebar-tab-link.active')
                .addEventListener('click', function (event) {
                    event.preventDefault()
                    addMessageToChat('user', 'Nuevo Chat')
                    postUserMessage('Nuevo Chat')
                })

            document
                .getElementById('sendButton')
                .addEventListener('click', function () {
                    const messageInput = document.getElementById('messageInput')
                    const message = messageInput.value.trim()
                    if (message !== '') {
                        addMessageToChat('user', message)
                        messageInput.value = ''
                        scrollToBottom()
                        postUserMessage(message)
                    }
                })

            document
                .getElementById('messageInput')
                .addEventListener('keydown', function (event) {
                    if (event.keyCode === 13 && !event.shiftKey) {
                        event.preventDefault()
                        document.getElementById('sendButton').click()
                    }
                })

            scrollToBottom()

            document
                .querySelector('.sidebar-tab-link.active')
                .addEventListener('click', function (event) {
                    event.preventDefault()
                    const chatContainer =
                        document.querySelector('.chat-container')
                    chatContainer.innerHTML = '' // Clear the chat container
                    addMessageToChat('user', 'Nuevo Chat')
                    postUserMessage('Nuevo Chat')
                })
        </script>
    </body>
</html>
